# ============================================================================
# Weather WMS - Environment Configuration
# ============================================================================
# Copy this file to .env and customize values for your deployment.
# These settings are read by docker-compose.yml and the startup scripts.
#
# Usage:
#   cp .env.example .env
#   # Edit .env with your custom values
#   ./scripts/start.sh
# ============================================================================

# ----------------------------------------------------------------------------
# DATABASE SETTINGS
# ----------------------------------------------------------------------------
POSTGRES_USER=weatherwms
POSTGRES_PASSWORD=weatherwms
POSTGRES_DB=weatherwms
DATABASE_URL=postgresql://weatherwms:weatherwms@postgres:5432/weatherwms
DATABASE_POOL_SIZE=50                # PostgreSQL connection pool size (default: 50)

# ----------------------------------------------------------------------------
# REDIS CACHE SETTINGS
# ----------------------------------------------------------------------------
REDIS_URL=redis://redis:6379
REDIS_TILE_TTL_SECS=3600             # L2 tile cache TTL in seconds (default: 3600 = 1hr)

# ----------------------------------------------------------------------------
# OBJECT STORAGE (MINIO/S3)
# ----------------------------------------------------------------------------
S3_ENDPOINT=http://minio:9000
S3_BUCKET=weather-data
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_REGION=us-east-1
S3_ALLOW_HTTP=true

# ----------------------------------------------------------------------------
# PERFORMANCE TUNING
# ----------------------------------------------------------------------------
TOKIO_WORKER_THREADS=8               # Async runtime worker threads (default: CPU cores)
RUST_LOG=info                        # Logging level: debug, info, warn, error
RUST_BACKTRACE=1                     # Enable backtraces for debugging

# ============================================================================
# PERFORMANCE OPTIMIZATION FEATURE FLAGS
# ============================================================================
# Set to "true" to enable, "false" to disable
# Useful for benchmarking individual optimizations

# --- L1 In-Memory Tile Cache (Phase 7.A) ---
ENABLE_L1_CACHE=true                 # Enable in-memory tile cache (huge performance boost)
TILE_CACHE_SIZE=10000                # Max tiles in L1 cache (~300MB at 30KB/tile)
TILE_CACHE_TTL_SECS=300              # L1 cache entry TTL (default: 5 minutes)

# --- GRIB Data Cache (Phase 4) ---
ENABLE_GRIB_CACHE=true               # Enable GRIB data caching (reduces storage I/O)
GRIB_CACHE_SIZE=500                  # Max GRIB files in cache (~2.5GB RAM)

# --- Tile Prefetching (Phase 7.B) ---
ENABLE_PREFETCH=true                 # Enable predictive tile prefetching
PREFETCH_RINGS=2                     # Rings to prefetch: 1=8 tiles, 2=24 tiles (default: 2)
PREFETCH_MIN_ZOOM=3                  # Minimum zoom level for prefetch
PREFETCH_MAX_ZOOM=12                 # Maximum zoom level for prefetch

# --- Cache Warming (Phase 7.D) ---
ENABLE_CACHE_WARMING=true            # Pre-render tiles at startup
CACHE_WARMING_MAX_ZOOM=4             # Max zoom level to warm (0-4 = 341 tiles)
CACHE_WARMING_HOURS=0                # Forecast hours to warm (comma-separated: 0,3,6)
CACHE_WARMING_LAYERS=gfs_TMP:temperature  # Layers to warm (semicolon-separated layer:style pairs)
CACHE_WARMING_CONCURRENCY=10         # Parallel warming tasks


# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================
GF_SECURITY_ADMIN_PASSWORD=admin     # Grafana admin password
GF_USERS_ALLOW_SIGN_UP=false         # Disable Grafana user sign-up
PROMETHEUS_RETENTION_DAYS=15         # Prometheus data retention

# ============================================================================
# LOAD TESTING
# ============================================================================
LOAD_TEST_RESULTS_DIR=./validation/load-test/results
LOAD_TEST_DEFAULT_CONCURRENCY=10
LOAD_TEST_DEFAULT_DURATION=60

# ============================================================================
# DEVELOPMENT SETTINGS
# ============================================================================
# Uncomment these for development/debugging

# RUST_LOG=debug                     # Enable debug logging
# RUST_BACKTRACE=full                # Full backtraces
# ENABLE_CACHE_WARMING=false         # Disable warming for faster startup
