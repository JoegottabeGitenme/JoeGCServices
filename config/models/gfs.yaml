# GFS - Global Forecast System Configuration
# NCEP Global Forecast System, 0.25° resolution
#
# Pressure levels available for ingestion:
# Lower troposphere: 1000, 975, 950, 925, 900, 850 mb
# Mid troposphere: 800, 750, 700, 650, 600, 550, 500, 450, 400, 350 mb
# Upper troposphere: 300, 250, 200, 150 mb
# Stratosphere: 100, 70, 50, 30, 20, 10 mb

model:
  id: gfs
  name: "GFS - Global Forecast System"
  description: "NCEP Global Forecast System, 0.25° resolution"
  enabled: true

# WMS/WMTS dimension configuration
# Defines which dimensions are exposed in capabilities and accepted in requests
dimensions:
  type: forecast           # "forecast" = RUN+FORECAST dimensions, "observation" = TIME dimension
  run: true                # RUN dimension - model initialization time (ISO8601)
  forecast: true           # FORECAST dimension - hours ahead from run time
  elevation: true          # ELEVATION dimension - vertical levels (from parameter definitions)

source:
  type: aws_s3
  bucket: noaa-gfs-bdp-pds
  prefix_template: "gfs.{date}/{cycle:02}/atmos"
  file_pattern: "gfs.t{cycle:02}z.pgrb2.0p25.f{forecast:03}"
  region: us-east-1
  
grid:
  projection: geographic
  resolution: "0.25deg"
  bbox:
    min_lon: 0.0
    min_lat: -90.0
    max_lon: 360.0
    max_lat: 90.0
  # Longitude convention: 0-360 (data is stored as 0-360, convert for -180 to 180 requests)
  lon_convention: 0_to_360

schedule:
  cycles: [0, 6, 12, 18]              # UTC hours (00z, 06z, 12z, 18z)
  forecast_hours: 
    start: 0
    end: 15                          # ~15 hours of forecast
    step: 3                           # Every 3 hours
  poll_interval_secs: 3600            # Check for new data every hour
  delay_hours: 4                      # Data typically available 4 hours after cycle time

retention:
  hours: 6                          # Keep data for 6 hours

# Precaching configuration - disabled for now
precaching:
  enabled: false
  keep_recent_cycles: 1               # Only most recent model cycle
  forecast_hours: [0, 3, 6, 9, 12]    # Key forecast hours
  warm_on_ingest: false
  poll_interval_secs: 300
  parameters: ["TMP", "UGRD", "VGRD"] # Most requested parameters

parameters:
  # ==========================================================================
  # Temperature Parameters
  # ==========================================================================
  
  # Surface Temperature (2m)
  - name: TMP
    description: "Temperature"
    levels:
      - type: height_above_ground
        value: 2
        display: "2 m above ground"
    style: temperature
    units: K
    display_units: °C
    conversion: K_to_C
    
  # Temperature at pressure levels
  - name: TMP
    description: "Temperature"
    levels:
      - type: isobaric
        values: [1000, 975, 950, 925, 900, 850, 700, 500, 300, 250, 200, 100, 70, 50, 30, 20, 10]
        display_template: "{value} mb"
    style: temperature
    units: K
    display_units: °C
    conversion: K_to_C

  # Dew Point Temperature (2m)
  - name: DPT
    description: "Dew Point Temperature"
    levels:
      - type: height_above_ground
        value: 2
        display: "2 m above ground"
    style: temperature
    units: K
    display_units: °C
    conversion: K_to_C

  # ==========================================================================
  # Wind Parameters
  # ==========================================================================

  # U-component wind at 10m and pressure levels
  - name: UGRD
    description: "U-Component of Wind"
    levels:
      - type: height_above_ground
        value: 10
        display: "10 m above ground"
      - type: isobaric
        values: [1000, 975, 950, 925, 900, 850, 700, 500, 300, 250, 200, 100]
        display_template: "{value} mb"
    style: wind
    units: m/s

  # V-component wind at 10m and pressure levels
  - name: VGRD
    description: "V-Component of Wind"
    levels:
      - type: height_above_ground
        value: 10
        display: "10 m above ground"
      - type: isobaric
        values: [1000, 975, 950, 925, 900, 850, 700, 500, 300, 250, 200, 100]
        display_template: "{value} mb"
    style: wind
    units: m/s

  # Surface wind gust
  - name: GUST
    description: "Wind Speed (Gust)"
    levels:
      - type: surface
        display: "surface"
    style: wind
    units: m/s

  # ==========================================================================
  # Pressure Parameters
  # ==========================================================================

  # Mean sea level pressure
  - name: PRMSL
    description: "Pressure Reduced to MSL"
    levels:
      - type: mean_sea_level
        display: "mean sea level"
    style: atmospheric
    units: Pa
    display_units: hPa
    conversion: Pa_to_hPa

  # Geopotential height
  - name: HGT
    description: "Geopotential Height"
    levels:
      - type: isobaric
        values: [1000, 925, 850, 700, 500, 300, 250, 200, 100, 70, 50, 30, 20, 10]
        display_template: "{value} mb"
    style: geopotential
    units: gpm

  # ==========================================================================
  # Moisture Parameters
  # ==========================================================================

  # Relative humidity
  - name: RH
    description: "Relative Humidity"
    levels:
      - type: height_above_ground
        value: 2
        display: "2 m above ground"
      - type: isobaric
        values: [1000, 975, 950, 925, 900, 850, 700, 500, 300]
        display_template: "{value} mb"
    style: humidity
    units: "%"

  # Precipitable Water (entire atmosphere column)
  - name: PWAT
    description: "Precipitable Water"
    levels:
      - type: entire_atmosphere
        display: "entire atmosphere"
    style: humidity
    units: kg/m^2
    display_units: mm

  # ==========================================================================
  # Precipitation Parameters
  # ==========================================================================
  
  # Total Precipitation (accumulated)
  - name: APCP
    description: "Total Precipitation"
    levels:
      - type: surface
        display: "surface"
    style: precipitation
    units: kg/m^2
    display_units: mm
    accumulation: true

  # ==========================================================================
  # Convective/Stability Parameters
  # ==========================================================================
  
  # Convective Available Potential Energy
  - name: CAPE
    description: "Convective Available Potential Energy"
    levels:
      - type: surface
        display: "surface"
    style: cape
    units: J/kg

  # Convective Inhibition
  - name: CIN
    description: "Convective Inhibition"
    levels:
      - type: surface
        display: "surface"
    style: cape
    units: J/kg

  # ==========================================================================
  # Cloud Parameters
  # ==========================================================================
  
  # Total Cloud Cover
  - name: TCDC
    description: "Total Cloud Cover"
    levels:
      - type: entire_atmosphere
        display: "entire atmosphere"
    style: cloud
    units: "%"

  # Low Cloud Cover
  - name: LCDC
    description: "Low Cloud Cover"
    levels:
      - type: low_cloud_layer
        display: "low cloud layer"
    style: cloud
    units: "%"

  # Middle Cloud Cover
  - name: MCDC
    description: "Middle Cloud Cover"
    levels:
      - type: middle_cloud_layer
        display: "middle cloud layer"
    style: cloud
    units: "%"

  # High Cloud Cover
  - name: HCDC
    description: "High Cloud Cover"
    levels:
      - type: high_cloud_layer
        display: "high cloud layer"
    style: cloud
    units: "%"

  # ==========================================================================
  # Visibility
  # ==========================================================================
  
  # Visibility
  - name: VIS
    description: "Visibility"
    levels:
      - type: surface
        display: "surface"
    style: visibility
    units: m
    display_units: km
    conversion: m_to_km

# Composite layers (derived from multiple parameters)
composites:
  - name: WIND_BARBS
    description: "Wind barbs visualization"
    requires: [UGRD, VGRD]
    renderer: wind_barbs
    style: wind_barbs
