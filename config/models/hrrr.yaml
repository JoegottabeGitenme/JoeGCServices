# HRRR - High-Resolution Rapid Refresh Configuration
# NCEP High-Resolution Rapid Refresh, 3km resolution, CONUS

model:
  id: hrrr
  name: "HRRR - High-Resolution Rapid Refresh"
  description: "NCEP High-Resolution Rapid Refresh, 3km resolution, CONUS coverage"
  enabled: true

# WMS/WMTS dimension configuration
# Defines which dimensions are exposed in capabilities and accepted in requests
dimensions:
  type: forecast           # "forecast" = RUN+FORECAST dimensions, "observation" = TIME dimension
  run: true                # RUN dimension - model initialization time (ISO8601)
  forecast: true           # FORECAST dimension - hours ahead from run time
  elevation: true          # ELEVATION dimension - vertical levels (from parameter definitions)

source:
  type: aws_s3
  bucket: noaa-hrrr-bdp-pds
  prefix_template: "hrrr.{date}/conus"
  file_pattern: "hrrr.t{cycle:02}z.wrfsfcf{forecast:02}.grib2"
  region: us-east-1
  
grid:
  projection: lambert_conformal
  resolution: "3km"
  bbox:
    min_lon: -122.719528
    min_lat: 21.138123
    max_lon: -60.917193
    max_lat: 47.842195
  projection_params:
    lat1: 21.138123
    lon1: -122.719528
    lov: -97.5             # Central meridian
    latin1: 38.5           # Standard parallel
    latin2: 38.5           # Standard parallel (tangent cone)
    dx: 3000.0             # meters
    dy: 3000.0             # meters
    nx: 1799
    ny: 1059

schedule:
  cycles: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]  # Hourly
  forecast_hours: 
    start: 0
    end: 3                          # 48 hours
    step: 1                          # Every hour
  poll_interval_secs: 3600           # Check every hour
  delay_hours: 2                     # Data typically available 2 hours after cycle

retention:
  hours: 2                          # Keep data for 2 hours

# Precaching configuration - disabled for now (focus on observation data first)
precaching:
  enabled: false
  keep_recent: 6                    # 6 most recent forecasts
  warm_on_ingest: false
  poll_interval_secs: 300
  parameters: ["TMP", "REFC"]       # Most requested parameters

parameters:
  # ==========================================================================
  # Pressure
  # ==========================================================================
  
  # Mean Sea Level Pressure
  - name: PRMSL
    description: "Mean Sea Level Pressure"
    levels:
      - type: mean_sea_level
        display: "mean sea level"
    style: atmospheric
    units: Pa
    display_units: hPa
    conversion: Pa_to_hPa

  # ==========================================================================
  # Surface & Near-Surface Parameters
  # ==========================================================================
  
  # Surface Temperature (2m)
  - name: TMP
    description: "Temperature"
    levels:
      - type: height_above_ground
        value: 2
        display: "2 m above ground"
    style: temperature
    units: K
    display_units: °C
    conversion: K_to_C

  # Dew Point Temperature (2m)
  - name: DPT
    description: "Dew Point Temperature"
    levels:
      - type: height_above_ground
        value: 2
        display: "2 m above ground"
    style: temperature
    units: K
    display_units: °C
    conversion: K_to_C

  # U-component wind (10m)
  - name: UGRD
    description: "U-Component of Wind"
    levels:
      - type: height_above_ground
        value: 10
        display: "10 m above ground"
      - type: isobaric
        values: [850, 700, 500, 300, 250]
        display_template: "{value} mb"
    style: wind
    units: m/s

  # V-component wind (10m)
  - name: VGRD
    description: "V-Component of Wind"
    levels:
      - type: height_above_ground
        value: 10
        display: "10 m above ground"
      - type: isobaric
        values: [850, 700, 500, 300, 250]
        display_template: "{value} mb"
    style: wind
    units: m/s

  # Relative Humidity (2m)
  - name: RH
    description: "Relative Humidity"
    levels:
      - type: height_above_ground
        value: 2
        display: "2 m above ground"
    style: humidity
    units: "%"

  # Precipitable Water (entire atmosphere)
  - name: PWAT
    description: "Precipitable Water"
    levels:
      - type: entire_atmosphere
        display: "entire atmosphere"
    style: humidity
    units: kg/m^2
    display_units: mm

  # Surface wind gust
  - name: GUST
    description: "Wind Speed (Gust)"
    levels:
      - type: surface
        display: "surface"
    style: wind
    units: m/s

  # ==========================================================================
  # Radar & Reflectivity
  # ==========================================================================
  
  # Composite Reflectivity  
  - name: REFC
    description: "Composite Reflectivity"
    levels:
      - type: height_above_ground
        value: 1000
        display: "1000 m above ground"
    style: reflectivity
    units: dBZ

  # Echo Top Height
  - name: RETOP
    description: "Echo Top Height"
    levels:
      - type: cloud_top
        display: "cloud top"
    style: default
    units: m
    display_units: kft
    conversion: m_to_kft

  # ==========================================================================
  # Precipitation Parameters
  # ==========================================================================
  
  # Total Precipitation
  - name: APCP
    description: "Total Precipitation"
    levels:
      - type: surface
        display: "surface"
    style: precipitation
    units: kg/m^2
    display_units: mm
    accumulation: true

  # ==========================================================================
  # Convective/Stability Parameters
  # ==========================================================================
  
  # Convective Available Potential Energy (surface-based)
  - name: CAPE
    description: "Convective Available Potential Energy"
    levels:
      - type: surface
        display: "surface"
    style: cape
    units: J/kg

  # Convective Inhibition
  - name: CIN
    description: "Convective Inhibition"
    levels:
      - type: surface
        display: "surface"
    style: cape
    units: J/kg

  # Updraft Helicity (2-5km layer) - Severe weather/tornado potential
  - name: MXUPHL
    description: "Maximum Updraft Helicity"
    levels:
      - type: height_above_ground_layer
        value: [2000, 5000]
        display: "2000-5000 m above ground"
    style: helicity
    units: m^2/s^2

  # ==========================================================================
  # Lightning
  # ==========================================================================
  
  # Lightning Threat (LTNG) - Total lightning density
  - name: LTNG
    description: "Lightning Threat"
    levels:
      - type: entire_atmosphere
        display: "entire atmosphere"
    style: lightning
    units: flashes/km^2/min

  # ==========================================================================
  # Visibility
  # ==========================================================================
  
  # Visibility
  - name: VIS
    description: "Visibility"
    levels:
      - type: surface
        display: "surface"
    style: visibility
    units: m
    display_units: km
    conversion: m_to_km

  # ==========================================================================
  # Cloud Cover
  # ==========================================================================
  
  # Total Cloud Cover
  - name: TCDC
    description: "Total Cloud Cover"
    levels:
      - type: entire_atmosphere
        display: "entire atmosphere"
    style: cloud
    units: "%"

  # Low Cloud Cover
  - name: LCDC
    description: "Low Cloud Cover"
    levels:
      - type: low_cloud_layer
        display: "low cloud layer"
    style: cloud
    units: "%"

  # Middle Cloud Cover
  - name: MCDC
    description: "Middle Cloud Cover"
    levels:
      - type: middle_cloud_layer
        display: "middle cloud layer"
    style: cloud
    units: "%"

  # High Cloud Cover
  - name: HCDC
    description: "High Cloud Cover"
    levels:
      - type: high_cloud_layer
        display: "high cloud layer"
    style: cloud
    units: "%"

  # ==========================================================================
  # Upper-Air Temperature
  # ==========================================================================
  
  # Temperature at pressure levels
  - name: TMP
    description: "Temperature"
    levels:
      - type: isobaric
        values: [850, 700, 500, 300, 250]
        display_template: "{value} mb"
    style: temperature
    units: K
    display_units: °C
    conversion: K_to_C

  # Geopotential Height at pressure levels
  - name: HGT
    description: "Geopotential Height"
    levels:
      - type: isobaric
        values: [850, 700, 500, 300, 250]
        display_template: "{value} mb"
    style: default
    units: gpm

# Composite layers
composites:
  - name: WIND_BARBS
    description: "Wind barbs visualization"
    requires: [UGRD, VGRD]
    renderer: wind_barbs
    style: wind_barbs
