# =============================================================================
# Docker Compose Override - Example WMS Server Integration
# =============================================================================
# 
# This file shows how to add your own WMS server to the test stack.
# Rename to docker-compose.override.yml to use automatically.
#
# Usage:
#   1. Rename this file: mv docker-compose.override.example.yml docker-compose.override.yml
#   2. Customize for your WMS implementation
#   3. Update .env with: WMS_CAPABILITIES_URL=http://wms-server:8080/...
#   4. Run: docker compose up -d
#
# =============================================================================

version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # Example: GeoServer
  # ---------------------------------------------------------------------------
  # wms-server:
  #   image: docker.osgeo.org/geoserver:2.24.x
  #   container_name: geoserver
  #   ports:
  #     - "8080:8080"
  #   volumes:
  #     - ./geoserver-data:/opt/geoserver_data
  #   environment:
  #     - SKIP_DEMO_DATA=false
  #   networks:
  #     - wms-test-network
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:8080/geoserver/web/"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 5

  # ---------------------------------------------------------------------------
  # Example: MapServer
  # ---------------------------------------------------------------------------
  # wms-server:
  #   image: camptocamp/mapserver:7.6
  #   container_name: mapserver
  #   ports:
  #     - "8080:80"
  #   volumes:
  #     - ./mapserver-data:/etc/mapserver
  #   networks:
  #     - wms-test-network

  # ---------------------------------------------------------------------------
  # Example: QGIS Server
  # ---------------------------------------------------------------------------
  # wms-server:
  #   image: qgis/qgis-server:latest
  #   container_name: qgis-server
  #   ports:
  #     - "8080:80"
  #   volumes:
  #     - ./qgis-projects:/io/data
  #   environment:
  #     - QGIS_PROJECT_FILE=/io/data/project.qgs
  #   networks:
  #     - wms-test-network

  # ---------------------------------------------------------------------------
  # Example: Your Custom WMS Implementation
  # ---------------------------------------------------------------------------
  wms-server:
    build:
      context: ./your-wms-server  # Path to your WMS server code
      dockerfile: Dockerfile
    container_name: my-wms
    ports:
      - "8080:8080"
    volumes:
      # Mount the Blue Lake test data
      - ./test-data:/data:ro
    networks:
      - wms-test-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/wms?SERVICE=WMS&REQUEST=GetCapabilities"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s

  # ---------------------------------------------------------------------------
  # Make test-runner depend on your WMS server
  # ---------------------------------------------------------------------------
  test-runner:
    depends_on:
      wms-server:
        condition: service_healthy
