# HRRR EDR Load Test Scenarios
#
# This file defines EDR API load test scenarios for HRRR collections.
# Run with: scripts/run_edr_load_test.sh scenarios/hrrr-edr.yaml
#
# Query Types:
# - position: Point query (fastest)
# - area: Polygon query (tests area query implementation)

name: hrrr-edr
description: |
  HRRR EDR API load test scenarios including position and area queries.
  Tests various polygon sizes and parameters for area query performance.

base_url: http://localhost:8083/edr
duration_secs: 60
concurrency: 10
warmup_secs: 5

# Collections to test
collections:
  - hrrr-surface
  - hrrr-isobaric

# Position Query Scenarios
position_queries:
  # Basic position queries
  - name: position_single_param
    collection: hrrr-surface
    coords: "POINT(-100 40)"
    parameters: ["TMP"]
    weight: 2.0
    
  - name: position_multi_param
    collection: hrrr-surface
    coords: "POINT(-100 40)"
    parameters: ["TMP", "RH", "GUST"]
    weight: 1.5
    
  - name: position_with_level
    collection: hrrr-isobaric
    coords: "POINT(-100 40)"
    parameters: ["TMP"]
    z: "850"
    weight: 1.0

# Area Query Scenarios
area_queries:
  # Basic area query - small 1x1 degree polygon
  - name: area_basic
    collection: hrrr-surface
    coords: "POLYGON((-101 39,-100 39,-100 40,-101 40,-101 39))"
    parameters: ["TMP"]
    weight: 2.0
    description: "Small 1x1 degree polygon over Kansas"
    
  # Small area - high resolution data extraction
  - name: area_small
    collection: hrrr-surface
    coords: "POLYGON((-100.5 39.5,-100.0 39.5,-100.0 40.0,-100.5 40.0,-100.5 39.5))"
    parameters: ["TMP"]
    weight: 1.5
    description: "0.5x0.5 degree polygon"
    
  # Medium area - 2x2 degrees
  - name: area_medium
    collection: hrrr-surface
    coords: "POLYGON((-102 38,-100 38,-100 40,-102 40,-102 38))"
    parameters: ["TMP", "RH"]
    weight: 1.0
    description: "2x2 degree polygon"
    
  # Area with multiple parameters
  - name: area_multi_param
    collection: hrrr-surface
    coords: "POLYGON((-101 39,-100 39,-100 40,-101 40,-101 39))"
    parameters: ["TMP", "RH", "GUST", "UGRD", "VGRD"]
    weight: 1.0
    description: "1x1 degree with 5 parameters"
    
  # Area with isobaric level
  - name: area_isobaric
    collection: hrrr-isobaric
    coords: "POLYGON((-101 39,-100 39,-100 40,-101 40,-101 39))"
    parameters: ["TMP"]
    z: "850"
    weight: 1.0
    description: "1x1 degree at 850 hPa"
    
  # Complex polygon - L-shaped
  - name: area_complex_L
    collection: hrrr-surface
    coords: "POLYGON((-102 38,-100 38,-100 40,-101 40,-101 39,-102 39,-102 38))"
    parameters: ["TMP"]
    weight: 0.5
    description: "L-shaped polygon"
    
  # Complex polygon - triangle
  - name: area_triangle
    collection: hrrr-surface
    coords: "POLYGON((-101 38,-99 39,-101 40,-101 38))"
    parameters: ["TMP"]
    weight: 0.5
    description: "Triangular polygon"
    
  # Multiple locations (randomized in test)
  - name: area_random_location
    collection: hrrr-surface
    random_bbox:
      min_lon: -120
      max_lon: -80
      min_lat: 30
      max_lat: 48
    polygon_size: 1.0  # 1 degree
    parameters: ["TMP"]
    weight: 1.5
    description: "Random 1x1 degree polygon within CONUS"

# Corridor Query Scenarios
corridor_queries:
  # Basic corridor query - 3-point linestring
  - name: corridor_basic
    collection: hrrr-surface
    coords: "LINESTRING(-101 39,-100 39.5,-99 40)"
    corridor_width: 10
    width_units: km
    corridor_height: 1000
    height_units: m
    parameters: ["TMP"]
    weight: 2.0
    description: "10km wide corridor across Kansas"
    
  # Small corridor - narrow path
  - name: corridor_narrow
    collection: hrrr-surface
    coords: "LINESTRING(-100.5 39.5,-100.0 40.0)"
    corridor_width: 5
    width_units: km
    corridor_height: 500
    height_units: m
    parameters: ["TMP"]
    weight: 1.5
    description: "5km narrow corridor"
    
  # Corridor with multiple parameters
  - name: corridor_multi_param
    collection: hrrr-surface
    coords: "LINESTRING(-101 39,-100 39.5,-99 40)"
    corridor_width: 10
    width_units: km
    corridor_height: 1000
    height_units: m
    parameters: ["TMP", "RH", "GUST", "UGRD", "VGRD"]
    weight: 1.0
    description: "10km corridor with 5 parameters"
    
  # Corridor with miles units
  - name: corridor_miles
    collection: hrrr-surface
    coords: "LINESTRING(-97.5 35.2,-97.0 35.5,-96.5 35.8)"
    corridor_width: 10
    width_units: mi
    corridor_height: 3000
    height_units: ft
    parameters: ["TMP"]
    weight: 1.0
    description: "10 mile wide corridor over Oklahoma"
    
  # Corridor with isobaric level
  - name: corridor_isobaric
    collection: hrrr-isobaric
    coords: "LINESTRING(-101 39,-100 39.5,-99 40)"
    corridor_width: 10
    width_units: km
    corridor_height: 1000
    height_units: m
    parameters: ["TMP"]
    z: "850"
    weight: 1.0
    description: "10km corridor at 850 hPa"
    
  # Long corridor - 5 point path
  - name: corridor_long
    collection: hrrr-surface
    coords: "LINESTRING(-102 38,-101 39,-100 39.5,-99 39,-98 40)"
    corridor_width: 15
    width_units: km
    corridor_height: 2000
    height_units: m
    parameters: ["TMP"]
    weight: 0.5
    description: "Long 5-point corridor path"
    
  # Random location corridor
  - name: corridor_random_location
    collection: hrrr-surface
    random_bbox:
      min_lon: -120
      max_lon: -80
      min_lat: 30
      max_lat: 48
    linestring_length: 2.0  # degrees
    linestring_points: 3
    corridor_width: 10
    width_units: km
    corridor_height: 1000
    height_units: m
    parameters: ["TMP"]
    weight: 1.5
    description: "Random corridor within CONUS"

# Radius Query Scenarios
radius_queries:
  # Basic radius query - 50km circle
  - name: radius_basic
    collection: hrrr-surface
    coords: "POINT(-100 40)"
    within: 50
    within_units: km
    parameters: ["TMP"]
    weight: 2.0
    description: "50km radius over Kansas"
    
  # Small radius - high resolution extraction
  - name: radius_small
    collection: hrrr-surface
    coords: "POINT(-100 40)"
    within: 25
    within_units: km
    parameters: ["TMP"]
    weight: 1.5
    description: "25km radius"
    
  # Medium radius with multiple parameters
  - name: radius_multi_param
    collection: hrrr-surface
    coords: "POINT(-100 40)"
    within: 50
    within_units: km
    parameters: ["TMP", "RH", "GUST", "UGRD", "VGRD"]
    weight: 1.0
    description: "50km radius with 5 parameters"
    
  # Radius with miles units
  - name: radius_miles
    collection: hrrr-surface
    coords: "POINT(-97.5 35.2)"
    within: 30
    within_units: mi
    parameters: ["TMP"]
    weight: 1.0
    description: "30 mile radius over Oklahoma"
    
  # Radius with isobaric level
  - name: radius_isobaric
    collection: hrrr-isobaric
    coords: "POINT(-100 40)"
    within: 50
    within_units: km
    parameters: ["TMP"]
    z: "850"
    weight: 1.0
    description: "50km radius at 850 hPa"
    
  # MULTIPOINT radius (union of circles)
  - name: radius_multipoint
    collection: hrrr-surface
    coords: "MULTIPOINT((-97.5 35.2),(-98.0 36.0))"
    within: 30
    within_units: km
    parameters: ["TMP"]
    weight: 0.5
    description: "Two 30km circles"
    
  # Random location radius
  - name: radius_random_location
    collection: hrrr-surface
    random_bbox:
      min_lon: -120
      max_lon: -80
      min_lat: 30
      max_lat: 48
    within: 50
    within_units: km
    parameters: ["TMP"]
    weight: 1.5
    description: "Random 50km radius within CONUS"

# Cube Query Scenarios
cube_queries:
  # Basic cube query - 1x1 degree bbox at 850 hPa
  - name: cube_basic
    collection: hrrr-isobaric
    bbox: "-101,39,-100,40"
    z: "850"
    parameters: ["TMP"]
    weight: 2.0
    description: "Basic 1x1 degree cube at 850 hPa"
    
  # Small cube - high resolution extraction
  - name: cube_small
    collection: hrrr-isobaric
    bbox: "-100.5,39.5,-100.0,40.0"
    z: "850"
    parameters: ["TMP"]
    weight: 1.5
    description: "Small 0.5x0.5 degree cube"
    
  # Multi-level cube - 3 pressure levels
  - name: cube_multi_level
    collection: hrrr-isobaric
    bbox: "-101,39,-100,40"
    z: "850,700,500"
    parameters: ["TMP"]
    weight: 1.0
    description: "Cube with 3 pressure levels"
    
  # Cube with multiple parameters
  - name: cube_multi_param
    collection: hrrr-isobaric
    bbox: "-101,39,-100,40"
    z: "850"
    parameters: ["TMP", "RH", "UGRD", "VGRD"]
    weight: 1.0
    description: "Cube with 4 parameters"
    
  # Cube with resolution control
  - name: cube_with_resolution
    collection: hrrr-isobaric
    bbox: "-102,38,-100,40"
    z: "850"
    parameters: ["TMP"]
    resolution_x: 10
    resolution_y: 10
    weight: 1.0
    description: "2x2 degree cube with 10x10 grid"
    
  # Medium cube - 2x2 degrees
  - name: cube_medium
    collection: hrrr-isobaric
    bbox: "-102,38,-100,40"
    z: "850,700"
    parameters: ["TMP", "RH"]
    weight: 0.8
    description: "2x2 degree cube at 2 levels"
    
  # Random location cube
  - name: cube_random_location
    collection: hrrr-isobaric
    random_bbox:
      min_lon: -120
      max_lon: -80
      min_lat: 30
      max_lat: 48
    bbox_size: 1.0  # 1 degree
    z: "850"
    parameters: ["TMP"]
    weight: 1.5
    description: "Random 1x1 degree cube within CONUS"

# Trajectory Query Scenarios
trajectory_queries:
  # Basic trajectory query - 3-point linestring
  - name: trajectory_basic
    collection: hrrr-surface
    coords: "LINESTRING(-101 39,-100 39.5,-99 40)"
    parameters: ["TMP"]
    weight: 2.0
    description: "Basic 3-point trajectory across Kansas"
    
  # Short trajectory - 2 points
  - name: trajectory_short
    collection: hrrr-surface
    coords: "LINESTRING(-100.5 39.5,-100.0 40.0)"
    parameters: ["TMP"]
    weight: 1.5
    description: "Short 2-point trajectory"
    
  # Trajectory with multiple parameters
  - name: trajectory_multi_param
    collection: hrrr-surface
    coords: "LINESTRING(-101 39,-100 39.5,-99 40)"
    parameters: ["TMP", "RH", "GUST", "UGRD", "VGRD"]
    weight: 1.0
    description: "Trajectory with 5 parameters"
    
  # Trajectory with isobaric level
  - name: trajectory_isobaric
    collection: hrrr-isobaric
    coords: "LINESTRING(-101 39,-100 39.5,-99 40)"
    parameters: ["TMP"]
    z: "850"
    weight: 1.0
    description: "Trajectory at 850 hPa"
    
  # Long trajectory - 5 point path
  - name: trajectory_long
    collection: hrrr-surface
    coords: "LINESTRING(-102 38,-101 39,-100 39.5,-99 39,-98 40)"
    parameters: ["TMP"]
    weight: 0.5
    description: "Long 5-point trajectory path"
    
  # LINESTRINGZ trajectory (with z coordinates)
  - name: trajectory_linestringz
    collection: hrrr-isobaric
    coords: "LINESTRINGZ(-101 39 850,-100 39.5 850,-99 40 850)"
    parameters: ["TMP"]
    weight: 0.5
    description: "Trajectory with Z coordinates at 850 hPa"
    
  # Random location trajectory
  - name: trajectory_random_location
    collection: hrrr-surface
    random_bbox:
      min_lon: -120
      max_lon: -80
      min_lat: 30
      max_lat: 48
    linestring_length: 2.0  # degrees
    linestring_points: 3
    parameters: ["TMP"]
    weight: 1.5
    description: "Random trajectory within CONUS"

# Edge cases (lower weight, for validation)
edge_cases:
  # Near maximum allowed size (should succeed)
  - name: area_near_max
    collection: hrrr-surface
    coords: "POLYGON((-105 35,-100 35,-100 40,-105 40,-105 35))"
    parameters: ["TMP"]
    weight: 0.3
    expected_status: 200
    description: "5x5 degree polygon - near max allowed"
    
  # Exceeds maximum size (should fail with 413 or 400)
  - name: area_too_large
    collection: hrrr-surface
    coords: "POLYGON((-125 25,-70 25,-70 50,-125 50,-125 25))"
    parameters: ["TMP"]
    weight: 0.1
    expected_status: [400, 413]
    description: "Full CONUS - should be rejected"
    
  # Radius too large (should fail with 413)
  - name: radius_too_large
    collection: hrrr-surface
    coords: "POINT(-100 40)"
    within: 1000
    within_units: km
    parameters: ["TMP"]
    weight: 0.1
    expected_status: 413
    description: "1000km radius - should be rejected"

# Test points for random location generation
test_points:
  - name: oklahoma
    lon: -97.5
    lat: 35.5
  - name: kansas
    lon: -100.0
    lat: 39.0
  - name: colorado
    lon: -105.0
    lat: 40.0
  - name: nebraska
    lon: -100.0
    lat: 41.0
  - name: texas
    lon: -97.0
    lat: 32.0
